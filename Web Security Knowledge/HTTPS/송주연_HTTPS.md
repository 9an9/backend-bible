# HTTPS 

> HTTPS로 사이트를 보호하는 방법 



### HTTPS 

Hypertext Transfer Protocol <u>Secure</u>

사용자 컴퓨터와 방문한 사이트간에 전송되는 <u>사용자 데이터의 무결성과 기밀성을 유지</u>할 수 있게 해주는 인터넷 통신 프로토콜 



1. 사용자가 전송하는 데이터 암호화
2. 접속한 사이트가 믿을만한 곳인지 알려준다



http는 인터넷상의 커뮤니케이션에서 사용되는 형식중 하나 --> 프로토콜 



---





### 1. HTTP와 TCP

   HTTP는 TCP 기반으로 만들어진 프로토콜이다 

   ![img](https://t1.daumcdn.net/cfile/tistory/997BA54A5F9D69212A)

   다음과 같이 클라이언트의 '인터넷 주소창'에서 서버의 '컴퓨터의 랜카드'에 도달하기 까지  모든 계층들을 지나가며 각 계층마다 **패킷** 이 붙게 된다 

   

   이런 이유로 7계층에서 동작하는 HTTP 프로토콜은 4계층의 TCP가 갖는 특징을 공유한다 

   TCP의 특징은 어떤 것이 있을까?

   1. 연결지향적 (connection-oriented service)
      + 송신자와 수신자 사이에 먼저 연결이 설정된 후 데이터 전송 
   2. 신뢰성 보장 
      + 만났을땐 악수 3번, 헤어질때 악수 4번
   3. 순서보장 
      + n번의 패킷이 보내진다면 n개가 순서대로 서버에 도착

   이런 모든 특징들은 HTTP도 가지고 있다 

   HTTP는 비연결형 이라고 하는데 어떻게 연결지향적이냐는 말이 나올 수 있다. 

   <u>HTTP에선 요청을 주고받을때만 연결을 유지하고 응답을 주고나면 TCP/IP 연결을 끊어버린다.</u> 

   계속해서 클라이언트를 기다리는 것은 **소켓** 프로그래밍이라는 것을 기억하자 

   

   

   아무튼 HTTP 프로토콜에서도 3번 악수로 첫인사, 4번 악수로 작별인사한다 

   

   > 참고자료
   >
   > https://hwan-shell.tistory.com/271

### 2. 대칭키와 비대칭키

   + 대칭키 방식 

     + 메세지 수신, 송신측이 메세지를 같은 방식으로 암호화 및 복호화 

     + 중간에 키가 탈취당할 수 있는 위험성 존재 

       

   + 비대칭키 방식 (개인키와 공개키)

     + A키로 암호화하려면 B키로 복호화 가능 
     + 사용자는 공개키로 암호화한 뒤 서버에 전송
     + 서버는 개인키로 복호화함 
     + 외부에서는 개인키를 구할 수 없기때문에 데이터 안전 

### 3. SSL / TLS


   SSL 및 TLS는 네트워크를 통해 작동하는 서버, 시스템 및 응용프로그램간에 인증 및 데이터 암호화를 제공하는 **암호화 프로토콜** 


### 4. HTTPS에서 악수하는 방법

   **TCP 통신 위에 안전한 계층을 추가하는 방식**

   안전한 계층은 SSL/TLS 인증서를 사용해서 만들어진다 

   ![Rcq1a](https://i.stack.imgur.com/Rcq1a.png)

   

   1. 클라이언트는 서버를 신뢰하지 않음 
   
   2. 상호간 신뢰를 위한 hanshaking
   
      1. 클라이언트는 랜덤 데이터 생성 후 서버에 전송
      2. 서버는 랜덤 데이터를 받고 서버에서 생성한 랜덤데이터와 서버의 인증서를 클라이언트에 전송 
   
   3. 클라이언트는 서버의 인증서가 진짜인지 브라우저에 내장된 CA(인증기관)들의 정보를 통해 확인
   
      1. 비대칭키 시스템을 사용함 
      
      2. 인증서는 해당 CA의 개인키로 암호화 돼있음 
      
      3. 인증서가 진짜라면 브라우저에 저장된 CA의 공개키로 복호화 가능 
      
         1. 복호화 실패했다면 이런 안내창 뜸
      
            ![사설 IP 대역에서 SSL 적용하기](https://t1.daumcdn.net/cfile/tistory/247EED4357F3C4880E)
      
         2. 인증서가 성공적으로 복호화된 경우, <u>인증서에서 서버의 공개키 GET</u> 
   
   4. 이후 비대칭키 방식 + 대칭키 방식이 혼합돼서 데이터 전송 
   
      1. 모든 데이터 전송을 비대칭키 방식으로 하지 않는 이유 --> 오버헤드가 큼 
      2. 대칭키를 공유할때 비대칭키를 사용하고 그 뒤로는 대칭키로 데이터 교환 
      3. 대칭키는 handshaking 과정에서 생성된 랜덤 데이터들에서 생성됨  

   


### 5. 키 교환 알고리즘    
공개키 암호화 방식은 사전에 안전하게 클라이언트-서버간에  서로의 공개키를 나누는 과정이 필요 

+ DHE-RSA 방식 (RSA: 서명, Diffie-Hellman: 키교환)
+ OCSP(Online Certificate Status Protocol)이라는 인증서 검증 프로토콜로 클라이언트가 서버에서 받은 인증서 및 루트 인증기관이 현재 유효환지 확인





> 참고자료
>
> + https://tech.ssut.me/https-is-faster-than-http/
> + https://brunch.co.kr/@sangjinkang/38



