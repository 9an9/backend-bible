# TCP/IP

> 목차
>
> 1. 인터넷
> 2. TCP / IP 계층
> 3. TCP / IP 흐름
> 4. 신뢰할 수 있는 TCP





## 1. 인터넷

> 전 세계에 걸쳐 파일 전송 등의 데이터 통신 서비스를 받을 수 있는 컴퓨터 네트워크의 시스템 



우리는 사업자(통신사)가 만들어 놓은 네트워크 인프라를 사용해서 인터넷을 한다. 

lg u+ 인터넷을 사용한다면 유플러스에서 설치해 놓은 인터넷 망을 통해서 인터넷을 사용한다. 

해외 인터넷과는 해저에 설치된 광속 케이블을 통해 연결되어 있다. 이렇게 케이블을 통해 데이터를 디지털 신호로 바꿔 전달하고, 디지털 신호를 데이터로 바꿔서 전달받는 방식으로 인터넷 통신이 이루어진다. 



### 프로토콜

네트워크 통신을 위해 미리 정해 놓은 공통된 메뉴얼 





## 2. TCP/ IP 계층

### TCP / IP

인터넷에서 컴퓨터들이 서로 정보를 주고 받는데 쓰이는 프로토콜의 집합 



![인터넷 프로토콜 스위트 - 위키백과, 우리 모두의 백과사전](https://upload.wikimedia.org/wikipedia/commons/d/d7/Application_Layer.png)

+ 어플리케이션 레이어
  + 특정 서비스를 제공하기 위해 애플리케이션끼리 정보를 주고 받을 수 있음 
  + e.g) 브라우저와 웹서버가 HTTP 요청/응답을 통해 통신하는 것
  + 프로토콜 
    + FTP, HTTP, SSH, DNS, SMTP 등등
+ 트렌스포트 레이어
  + 송신된 데이터를 수신측 애플리케이션에 확실히 전달하게 함
  + **포트번호** 를 사용해서 애플리케이션을 찾아주는 역할
  + 프로토콜
    + TCP, UDP 등
+ 인터넷 레이어
  + 수신측까지 데이터를 전달하기 위함 
  + 송신측, 수신측 모두 IP 주소를 가지는데 IP 주소를 바탕으로 올바른 목적지까지 찾아갈 수 있도록 함 
    + Forwarding, Routing
  + 프로토콜
    + IP, ARP 등 
+ 네트워크 엑세스 레이어
  + 네트워크에 직접 연결된 기기간의 데이터 전송을 도와줌 
  + 물리적 주소인 MAC 주소 사용 
    + MAC 주소: 
  + 프로토콜
    + Ethernet, PPP, Token Ring 등



## 3. TCP/IP의 흐름



> "www.google.com"을 웹 브라우저에 입력하면 무슨일이 일어날까요?



(http)www.google.com(:80) 입력

1. Application Layer
   + 구글 웹서버의 80 포트로 HTTP Request 메세지를 보냄
   + **HTTP 헤더**

2. Transport Layer

   + 80포트로 요청됨 
   + **TCP 헤더**
   + ![img](https://t1.daumcdn.net/cfile/tistory/2332D743539FF90A31)
     + SP
       + 시작 포트번호
       + 내 컴퓨터에서 만든 소켓의 포트 번호
       + 내 컴퓨터는 알고 있음 
     + DP
       + 목적지 포트번호
       + *위 예시에서는 80*
         + 웹 서버의 well known 포트번호

3. Internet Layer

   + **IP 헤더**
   + ![Ethernet, IP, TCP/UDP 헤더 소개 : Packet Header: Ethernet, IP & TCP/IP](https://t1.daumcdn.net/cfile/blog/1320C543504E8F001D)
     + SA (IP)
       + Start Address IP
       + 내 IP 주소
     + DA (IP)
       + Destination Address IP
       + DNS 프로토콜을 통해 도메인만으로 목적지 IP주소를 알 수 있음 

4. Network Access Layer

   + **Ethernet** 헤더

   + ![Ethernet, IP, TCP/UDP 헤더 소개 : Packet Header: Ethernet, IP & TCP/IP](https://t1.daumcdn.net/cfile/blog/17236F43504E8F001A)

     + SA (MAC)

       + 

     + DA (MAC)

       + 목적지인 구글 웹서버의 MAC 주소가 필요할까?

       + ㄴㄴ 물리적으로 연결된 우리집 공유기의 MAC 주소가 필요

       + 먼저 공유기와 연결하면 다른 인터넷과 연결이 가능하니 이것을 게이트웨이 라고 부름

       + **게이트 웨이**

         + `netstat -rn` 명령어를 통해 터미널에서 알 수 있음 

         + *어떻게 IP 주소로 MAC 주소를 알 수 있을까?*
           + **ARP**
             + IP 주소를 MAC 주소로 바꿔주는 <u>주소해석 프로토콜</u> 





위의 절차에 따라서 패킷의 네트워크 요청 준비 완료 

요청을 보내기 전에 한가지 더 봐야할 것이 있음 

그것은 바로 TCP가 인터넷과 제대로 연결이 되어있는가. 



## 3. TCP / IP 흐름 

> TCP는 연결지향형 프로토콜



위의 2번 과정을 통해 구글에 접속해서 요청할 내용을 담은 헤더들이 완성되었다. 

그렇다면 이런 헤더들이 어떤 흐름을 커져서 구글 서버 컴퓨터에 도착할까? 



1. 클라이언트 - 서버 연결 

   + **3 way handshaking**

     1.  요청을 보내는 클라이언트와 요청을 받는 서버가 서로 연결되는 작업이 필요

     2. 클라이언트와 서버 모두 데이터를 전송할 준비가 되었다는 것을 보장 

        실제 데이터 전달이 시작되기 전에 다른 한쪽이 준비가 되었다는 것을 알 수 있도록 한다. 

2. NAT

   + **Network Access Layer**
   + Network Address Translation 
   + 클라이언트 컴퓨터의 원래 IP 주소는 Private IP
   + 공유기를 통해 외부로 나갈때 Public IP로 주소를 변환해서 나가는 작업 필요

3. Routing

   + **Network Access Layer**
   + 공유기를 거치고 나서 구글 서버에 도착하기 위해 여러 라우터를 거쳐야 함
   + 라우터
     + 네트워크와 네트워크를 연결해주는 역할
   + 라우터와 라우터를 거쳐서 목적지 주소를 찾아 나가는 과정 

4. ARP

   + **Network Access Layer, Internet Layer**
   + <u>Internet Layer의 IP 주소를 사용해서 Network Access Layer에서는 MAC 주소를 얻음</u>
   + 라우터를 거쳐 구글 서버가 있는 라우터까지 도착하면 해당 라우터와 연결된 네트워크 중 목적지 네트워크의 MAC 주소를 얻어와야 함
   + 패킷의 IP헤더에 기록된 구글 서버 IP 주소를 통해 MAC 주소를 얻어와야 하는데 
     이 과정에서 ARP 프로토콜 사용 
     + ARP는 라우터가 연결된 네트워크 중 목적지인 구글 서버 네트워크에 브로드캐스팅 됨 
     + 목적지 구글 서버가 자신의 IP로 온 ARP 요청을 받고 MAC 주소를 응답 
     + 이런 과정을 통해 데이터가 물리적으로 전달될 수 있음 

   

5. Transport Layer
   + 트렌스포트 레이어의 목적지 포트번호에는 80번이 적혀있음
   +  해당 포트번호에 해당하는 프로세스에게 데이터 전달 
6. Application Layer
   + 목적지인 구글 서버가 HTTP Request 데이터를 읽을 수 있게 됨 
   + 요청에 대 적절한 html 응답 

7. 클라이언트 - 서버 연결 종료
   + **4 way handshaking** 
     + ACK, FIN 플래그가 사용됨 
     + **TIME_WAIT**
       + 4 way hand shaking 과정이 완료되어도 소켓을 닫지 않고 잉여패킷을 기다리는 상태
       + 서버에서 FIN을 보내기 전에 전송했던 패킷이 FIN보다 늦게 도착했을 경우 
         + 서버로부터 FIN을 수신했다고 클라이언트가 바로 연결된 소켓을 닫아버리면  데이터가 유실될 수 있음
         + 클라이언트는 서버로부터 FIN 요청을 받더라도 일정시간동안 소켓을 닫지 않고 잉여패킷을 기다림 





## 4. 신뢰할 수 있는 TCP



 인터넷 세상에서 클라이언트와 서버는 엄청나게 큰 데이터를 주고 받는다. 

한개의 패킷으로만 주고 받기에는 상당한 무리가 있기 때문에 데이터를 잘게 쪼개서 보내고 많은 패킷을 보내게 된다. 

이렇게 인터넷 세상에 내던저진 패킷들이 전송 과정에서 유실되지 않고 올바른 순서대로 잘 도착하게 하기 위해서는 **신뢰할할 수 있는 프로토콜인 TCP가 가능하게 함 **





> 덧, 
>
> TCP의 흐름제어, 오류제어, 혼잡제어는 무엇일까?,,,, 

---



> 참고 자료 
>
> https://www.youtube.com/watch?v=BEK354TRgZ8

