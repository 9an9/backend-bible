### 5장. 프로세스 관리

#### 1. 프로세스의 개념

> 프로세스 : 메모리에 올라가서 실행중인 프로그램.
>
> - 프로세스의 문맥
>   - 특정 시점에 프로세스가 어떤 상태인지 규명하기 위한 정보
>   - 하드웨어 문맥 : CPU의 수행 상태를 나타냄. Program Counter(PC) 값과 레지스터에 저장하고 있는 값들
>   - 프로세스의 주소공간 : code, data, stack
>   - 프로세스 관련 커널 자료구조 : PCB, kernel stack

#### 2. 프로세스의 상태

> - Running : CPU를 잡고 instruction을 실행 중인 상태.
>
> - Ready : 메모리에 올라가 있으며 CPU를 기다리는 상태.
> - Blocked(wait, sleep) : CPU를 줘도 당장 Instruction을 수행할 수 있는 상태. ex)I/O실행중
> - New : 프로세스 생성중.(프로세스를 위한 각종 자료구조는 생성되었지만 아직 메모리 획득을 승인받지 못한 상태)
> - Terminated : 수행 끝 (수행이 끝난다면 프로세스가 아니므로 정리해야 할 자원이 남아있는 등 종료 중인 상태)
>   - 문맥 교환 : 기존 프로세스의 문맥을 저장하고 새로운 프로세스의 문맥을 세팅하는 과정
>   - CPU dispatch : 준비 상태에 있는 프로세스들 중에서 CPU를 할당받을 프로세스를 선택한 후 실제로 CPU의 제어권을 넘겨받는 과정
>
> ![프로세스의 정의와 구성](https://t1.daumcdn.net/cfile/tistory/111C2F3F511554B124) 

#### 3. 프로세스 제어블록

<img src="https://benchpartner.com/bp-content/uploads/2022/01/14-YfLsSgamGmd.jpg" alt="Process Control Block (PCB) - Bench Partner" style="zoom: 50%;" />

> 1. 운영체제가 관리상 사용하는 정보
>    - 프로세스의 상태, 프로세스의 번호, 스케줄링 정보, 우선순위
> 2. CPU 수행 관련 하드웨어 값
>    - 프로그램 카운터, 레지스터
> 3. 메모리 관련
>    - 코드, 데이터, 스택의 위치 정보
> 4. 파일 관련
>    - 프로세스가 오픈한 파일 정보

#### 4. 문맥교환(Context Switch)

> CPU를 한 프로세스에서 다른 프로세스로 넘겨주는 과정
>
> System call, interrupt가 발생 시에도 모든 경우가 아닌 프로세스가 넘어가야 문맥교환.

#### 5. 프로세스를 스케줄링하기 위한 큐

> - Job Queue : 현재 시스템 내에 있는 모든 프로세스의 집합
> - Ready Queue : CPU
> - Device Queue : I/O

#### 6. 스케줄러

> 스케줄러란 어떤 프로세스에게 자원을 할당할지를 결정하는 운영체제 커널의 코드를 지칭한다.
>
> - Long-term scheduler(장기, 작업 스케줄러) 
>   - 메모리에 올라갈 프로세스 수 제어
>   - 시작 상태의 프로세스 중 어떤 프로세스를 준비 큐에 삽입할지 결정
>   - degree of multiprogramming 조절
> - Short-term scheduler(단기, CPU스케줄러) 
>   - 어떤 프로세스를 실행할지 결정(CPU를 할당할지)
> - Midium-term scheduler(중기, Swapper 스케줄러) 
>   - 현대의 시분할 시스템용 운영체제에서는 장기 스케줄러 대신 중기 스케줄러를 주로 사용.
>   - 프로세스당 메모리 양이 지나치게 적어진 경우 프로세스를 통째로 메모리에서 디스크의 스왑 영역으로 쫓아냄. (swap out)
>   - 프로세스의 수행이 정지된 상태를 나타내는 중지(suspended, stopped)상태가 추가됨.
>     - suspended(stopped) : 외부적인 이유로 프로세스의 수행이 정지된 상태
>       - blocked : 자신이 요청한 event가 만족되면 ready
>       - suspended : 외부에서 resume(재개)해주어야 active

![운영체제/OS 프로세스 - My LifeChronicle](https://many258.github.io/assets/images/OS/process-state-diagram.png)

#### 7. 프로세스의 생성

> 시스템이 부팅된 후 최초의 프로세스는 운영체제가 직접 생성하지만 그다음부터는 이미 존재하는 프로세스가 다른 프로세스를 복제 생성.
>
> - 부모 프로세스와 자식 프로세스가 존재하는 계층 구조
> - 자식 프로세스가 먼저 종료되며 이에 대한 처리는 부모 프로세스가 담당한다.
> - 자원의 공유
>   - 부모와 자식이 자원을 공유하는 모델 => 자식과 부모가 CPU를 획득하기 위해 경쟁
>   - 자식이 종료될 때까지 부모가 기다리는 모델 => 자식이 완료될 때까지 부모 프로세스는 봉쇄 상태
> - 주소 공간
>   - 자식 프로세스는 부모 프로세스의 주소 공간을 그대로 복사해서 생성한 후 다른 프로그램을 실행하기 위해 새로우 프로그램의 주소 공간을 덮어씌워 실행
>   - fork() : 복제
>   - exec() : 덮어씌우기
> - 종료
>   - exit()을 사용한 자발적 종료
>     -  자식이 부모에게 output data 를 보냄
>   - abort()를 사용한 비 자발적 종료 : 부모 프로세스가 자식 프로세스의 수행을 강제로 종료
>     - 자식 프로세스가 할당 자원의 한계치를 넘어서는 많은 양의 자원을 요구할 때
>     - 자식 프로세스에게 할당된 작업이 더 이상 필요하지 않을 때
>     - 부모 프로세스가 종료되는 경우

#### 8. 프로세스간의 협력

