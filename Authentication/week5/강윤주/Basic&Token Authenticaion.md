# Basic Authenticaion

![basic authentication](https://blog.kakaocdn.net/dn/bkH6Op/btq9nCiECmk/pwa7GOsvGv4XgyMIqUlkm0/img.png)

자료 출처: http://www.asp.net/web-api/overview/security/basic-authentication

1. 서버가 사용자에게 인증 요구를 원할 때, 서버는 401 Unauthorized 응답과 함께 WWW-Authenticate 헤더를 포함해서 클라이언트에게 전송한다.
   - 이 정보에는 클라이언트가 어떻게 인증해야 할지 포함되어 있고, 위 예시에서는 Basic 인증을 요청 한다.
2. 해당 메시지를 받은 클라이언트는 서버에게 인증 메시지를 보낼 수 있다.
   - 위 그림에서는 서버가 Basic 인증을 요청 했기 때문에, 인코딩(BASE64)된 비밀번호와 그 외 인증 파라미터들을 Authorization 헤더에 담아서 메시지를 보낸다.
3. 성공적으로 완료되면 서버는 정상적으로 200 OK 코드를 반환한다.
   - 추가적인 인증 알고리즘에 대한 정보는 Authentication-Info 헤더에 기술한다.



# Token Authentication

![token authenticaion](https://velog.velcdn.com/images%2Fdevjade%2Fpost%2Fb9ce9de4-e966-4fcd-8e57-39d808aa3e1a%2Fimage.png)

(이미지 출처: 코드스테이츠)

1. 클라이언트가 서버에 아이디/비밀번호를 담아 로그인 요청을 보낸다.
2. 아이디/비밀번호가 일치하는지 확인하고, 클라이언트에게 보낼 암호화된 토큰을 생성한다.
   - access/refresh 토큰을 모두 생성한다.
   - 토큰에 담길 정보(payload)는 유저를 식별할 정보, 권한이 부여된 카테고리(사진, 연락처, 기타등등)이 될 수 있다.
   - 두 종류의 토큰이 같은 정보를 담을 필요는 없다.
3. 토큰을 클라이언트에게 보내주면, 클라이언트는 토큰을 저장한다.
   - 저장하는 위치는 local storage, cookie, react의 state 등 다양하다.
4. 클라이언트가 HTTP 헤더(authorization 헤더)에 토큰을 담아 보낸다.
   - bearer authentication을 이용한다.
5. 서버는 토큰을 해독하여 "아 우리가 발급해준 토큰이 맞네!" 라는 판단이 될 경우, 클라이언트의 요청을 처리한 후 응답을 보내준다.

### 토큰기반 인증의 장점

1. Statelessness & Scalability (무상태성 & 확장성)
   - 서버는 클라이언트에 대한 정보를 저장할 필요 없다 (토큰 해독이 되는지만 판단)
   - 클라이언트는 새로운 요청을 보낼때마다 토큰을 헤더에 포함시키면 된다
   - 서버를 여러개 가지고 있는 서비스라면 더더욱 토큰기반 인증이 알맞은 인증방식이다 (같은 토큰으로 여러 서버에서 인증 가능)
2. 안전하다
   - 암호화 한 토큰을 사용하고, 암호화 키를 노출 할 필요가 없기 때문에 안전하다
3. 어디서나 생성 가능하다
   - 토큰을 확인하는 서버가 토큰을 만들어야 하는 법이 없다
   - 토큰 생성용 서버를 만들거나, 다른 회사에서 토큰관련 작업을 맡기는 것 등 다양한 활용이 가능하다
4. 권한 부여에 용이하다
   - 토큰의 payload(내용물) 안에 어떤 정보에 접근 가능한지 정할 수 있다

### 세션기반인증 & 토큰기반인증 차이

세션기반 인증은 서버(혹은 DB 통합)에 유저에 대한 정보를 저장하고 있다. 

즉 메모리 공간을 서버쪽에서 차지하고 있고, 자원을 사용하고 있으므로 유저가 많으면 많을수록 성능이 떨어지기 마련이다(사용하는 유저가 많으면 토큰기반 인증이어도 과부하가 될 수 있겠지만, 세션기반 인증만큼은 아니다). 

어느 한쪽이 더 안전한 인증 방식이라고는 얘기할 수 없지만, 앱의 확장을 고려한다면(여러개의 서버를 사용하며 점점 커져가는 앱이라면), 토큰기반 인증을 사용하는 것을 고려해봐야 할 것이다.

세션은 보통 하나의 서버에서만 접속 상태를 저장한다. 여러 개의 서버에서 같은 세션 데이터에 접근하려고 한다면, (인증 정보를 여러 서버가 공유해야 하니까) session clustering 혹은 공통 session store를 사용해야 하는 번거로움이 있다. 따라서 불가능한것은 아니다.

토큰기반 인증에서 서버가 해야 하는 일은, salt를 알고 verify 하기만 하면 된다. 클라이언트로만 인증하면 서버의 부담이 없다.